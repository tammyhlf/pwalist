{"ast":null,"code":"import{useEffect,useRef,useState}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Install(){const promptRef=useRef(null);const installRef=useRef(null);const[installing,setInstalling]=useState(false);const[progress,setProgress]=useState(0);const onInstall=()=>{const prompt=promptRef.current;if(prompt){setInstalling(true);prompt.prompt();prompt.userChoice.then(choiceResult=>{if(choiceResult.outcome==='accepted'){console.log('User accepted the A2HS prompt');simulateInstallProgress();}else{console.log('User dismissed the A2HS prompt');setInstalling(false);}promptRef.current=null;const installButton=document.getElementById('install-button');if(installButton){installButton.style.display='none';}});}};const simulateInstallProgress=()=>{let progressValue=0;const interval=setInterval(()=>{progressValue+=10;setProgress(progressValue);if(progressValue>=100){clearInterval(interval);setInstalling(false);console.log('PWA installed successfully');window.location.reload();// 打开已安装的PWA应用\n}},500);};useEffect(()=>{const onBeforeInstallPrompt=e=>{e.preventDefault();promptRef.current=e;console.log('beforeinstallprompt event was fired');const installButton=document.getElementById('install-button');if(installButton){installButton.style.display='block';}};const onAppInstalled=()=>{console.log('PWA was installed');setInstalling(false);setProgress(100);window.location.reload();// 打开已安装的PWA应用\n};window.addEventListener('beforeinstallprompt',onBeforeInstallPrompt);window.addEventListener('appinstalled',onAppInstalled);return()=>{window.removeEventListener('beforeinstallprompt',onBeforeInstallPrompt);window.removeEventListener('appinstalled',onAppInstalled);};},[]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{id:\"install-button\",ref:installRef,onClick:onInstall,children:\"install\"}),installing&&/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u5B89\\u88C5\\u4E2D: \",progress,\"%\"]})]});}","map":{"version":3,"names":["useEffect","useRef","useState","jsx","_jsx","jsxs","_jsxs","Install","promptRef","installRef","installing","setInstalling","progress","setProgress","onInstall","prompt","current","userChoice","then","choiceResult","outcome","console","log","simulateInstallProgress","installButton","document","getElementById","style","display","progressValue","interval","setInterval","clearInterval","window","location","reload","onBeforeInstallPrompt","e","preventDefault","onAppInstalled","addEventListener","removeEventListener","children","id","ref","onClick"],"sources":["/Users/tammy/Downloads/pwalist/src/pages/Install.js"],"sourcesContent":["import { useEffect, useRef, useState } from 'react'\n\nexport default function Install() {\n  const promptRef = useRef(null)\n  const installRef = useRef(null)\n  const [installing, setInstalling] = useState(false)\n  const [progress, setProgress] = useState(0)\n\n  const onInstall = () => {\n    const prompt = promptRef.current\n    if (prompt) {\n      setInstalling(true)\n      prompt.prompt()\n      prompt.userChoice.then((choiceResult) => {\n        if (choiceResult.outcome === 'accepted') {\n          console.log('User accepted the A2HS prompt')\n          simulateInstallProgress()\n        } else {\n          console.log('User dismissed the A2HS prompt')\n          setInstalling(false)\n        }\n        promptRef.current = null\n        const installButton = document.getElementById('install-button')\n        if (installButton) {\n          installButton.style.display = 'none'\n        }\n      })\n    }\n  }\n\n  const simulateInstallProgress = () => {\n    let progressValue = 0\n    const interval = setInterval(() => {\n      progressValue += 10\n      setProgress(progressValue)\n      if (progressValue >= 100) {\n        clearInterval(interval)\n        setInstalling(false)\n        console.log('PWA installed successfully')\n        window.location.reload() // 打开已安装的PWA应用\n      }\n    }, 500)\n  }\n\n  useEffect(() => {\n    const onBeforeInstallPrompt = (e) => {\n      e.preventDefault()\n      promptRef.current = e\n      console.log('beforeinstallprompt event was fired')\n      const installButton = document.getElementById('install-button')\n      if (installButton) {\n        installButton.style.display = 'block'\n      }\n    }\n\n    const onAppInstalled = () => {\n      console.log('PWA was installed')\n      setInstalling(false)\n      setProgress(100)\n      window.location.reload() // 打开已安装的PWA应用\n    }\n\n    window.addEventListener('beforeinstallprompt', onBeforeInstallPrompt)\n    window.addEventListener('appinstalled', onAppInstalled)\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', onBeforeInstallPrompt)\n      window.removeEventListener('appinstalled', onAppInstalled)\n    }\n  }, [])\n\n  return (\n    <div>\n      <div id=\"install-button\" ref={installRef} onClick={onInstall}>\n        install\n      </div>\n      {installing && <div>安装中: {progress}%</div>}\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}